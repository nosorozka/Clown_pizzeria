<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <!-- Header Fragment -->
  <head th:fragment="head(title)">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="${title} + ' | Clown Pizzeria'">Clown Pizzeria</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --primary-red: #e63946;
        --primary-yellow: #ffbe0b;
        --dark-bg: #1a1a2e;
        --card-bg: #16213e;
        --text-light: #edf2f4;
      }

      body {
        font-family: 'Nunito', sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        min-height: 100vh;
        color: var(--text-light);
      }

      .navbar {
        background: rgba(26, 26, 46, 0.95) !important;
        backdrop-filter: blur(10px);
        border-bottom: 2px solid var(--primary-red);
      }

      .navbar-brand {
        font-family: 'Fredoka One', cursive;
        font-size: 1.8rem;
        color: var(--primary-yellow) !important;
      }

      .navbar-brand i {
        color: var(--primary-red);
      }

      .nav-link {
        color: var(--text-light) !important;
        font-weight: 600;
        transition: color 0.3s;
      }

      .nav-link:hover {
        color: var(--primary-yellow) !important;
      }

      .btn-pizza {
        background: linear-gradient(135deg, var(--primary-red), #ff6b6b);
        border: none;
        color: white;
        font-weight: 700;
        padding: 0.75rem 1.5rem;
        border-radius: 50px;
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .btn-pizza:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(230, 57, 70, 0.4);
        color: white;
      }

      .btn-cart {
        background: linear-gradient(135deg, var(--primary-yellow), #ffd60a);
        color: #1a1a2e;
      }

      .btn-cart:hover {
        box-shadow: 0 10px 30px rgba(255, 190, 11, 0.4);
        color: #1a1a2e;
      }

      .card-pizza {
        background: var(--card-bg);
        border: none;
        border-radius: 20px;
        overflow: hidden;
        transition: transform 0.3s, box-shadow 0.3s;
      }

      .card-pizza:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }

      .card-pizza img {
        height: 200px;
        object-fit: cover;
      }

      .price-tag {
        font-family: 'Fredoka One', cursive;
        font-size: 1.5rem;
        color: var(--primary-yellow);
      }

      .badge-tag {
        background: rgba(255, 190, 11, 0.2);
        color: var(--primary-yellow);
        border: 1px solid var(--primary-yellow);
        font-weight: 600;
      }

      .cart-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: var(--primary-red);
        border-radius: 50%;
        padding: 0.25rem 0.5rem;
        font-size: 0.75rem;
        font-weight: 700;
      }

      .footer {
        background: rgba(26, 26, 46, 0.95);
        border-top: 2px solid var(--primary-red);
        padding: 2rem 0;
        margin-top: 4rem;
      }

      .form-control,
      .form-select {
        background: var(--card-bg);
        border: 1px solid rgba(255, 255, 255, 0.1);
        color: var(--text-light);
      }

      .form-control:focus,
      .form-select:focus {
        background: var(--card-bg);
        border-color: var(--primary-yellow);
        color: var(--text-light);
        box-shadow: 0 0 0 0.25rem rgba(255, 190, 11, 0.25);
      }

      .table {
        color: var(--text-light);
      }

      .table-dark {
        --bs-table-bg: var(--card-bg);
      }
    </style>
  </head>

  <!-- Navbar Fragment -->
  <nav th:fragment="navbar" class="navbar navbar-expand-lg navbar-dark sticky-top">
    <div class="container">
      <a class="navbar-brand" th:href="@{/}">
        <i class="bi bi-emoji-laughing me-2"></i>Clown Pizzeria
      </a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto">
          <li class="nav-item">
            <a class="nav-link" th:href="@{/}"><i class="bi bi-house me-1"></i>Domov</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" th:href="@{/menu}"><i class="bi bi-grid me-1"></i>Menu</a>
          </li>
          <li class="nav-item" sec:authorize="hasRole('USER')">
            <a class="nav-link" th:href="@{/orders}"
              ><i class="bi bi-receipt me-1"></i>Moje objednávky</a
            >
          </li>
          <!-- Cook link -->
          <li class="nav-item" sec:authorize="hasRole('COOK')">
            <a class="nav-link" style="color: var(--primary-red) !important" th:href="@{/cook}">
              <i class="bi bi-fire me-1"></i>Kuchyňa
            </a>
          </li>
          <!-- Courier link -->
          <li class="nav-item" sec:authorize="hasRole('COURIER')">
            <a
              class="nav-link"
              style="color: var(--primary-yellow) !important"
              th:href="@{/courier}"
            >
              <i class="bi bi-truck me-1"></i>Doručovanie
            </a>
          </li>
          <!-- Admin link -->
          <li class="nav-item" sec:authorize="hasRole('ADMIN')">
            <a class="nav-link text-warning" th:href="@{/admin}">
              <i class="bi bi-gear me-1"></i>Admin
            </a>
          </li>
        </ul>
        <ul class="navbar-nav">
          <li class="nav-item me-3" sec:authorize="hasRole('USER') or !isAuthenticated()">
            <a class="nav-link position-relative" th:href="@{/cart}">
              <i class="bi bi-cart3 fs-5"></i>
              <span
                class="cart-badge"
                id="cartBadge"
                th:text="${cartCount}"
                th:if="${cartCount != null && cartCount > 0}"
                >0</span
              >
            </a>
          </li>
          <li class="nav-item" sec:authorize="!isAuthenticated()">
            <a class="btn btn-outline-light btn-sm me-2" th:href="@{/auth/login}">Prihlásiť</a>
          </li>
          <li class="nav-item" sec:authorize="!isAuthenticated()">
            <a class="btn btn-pizza btn-sm" th:href="@{/auth/register}">Registrácia</a>
          </li>
          <li class="nav-item dropdown" sec:authorize="isAuthenticated()">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
              <i class="bi bi-person-circle me-1"></i>
              <span sec:authentication="principal.username">Používateľ</span>
            </a>
            <ul class="dropdown-menu dropdown-menu-dark dropdown-menu-end">
              <li sec:authorize="hasRole('USER')">
                <a class="dropdown-item" th:href="@{/orders}">
                  <i class="bi bi-receipt me-2"></i>Moje objednávky
                </a>
              </li>
              <li sec:authorize="hasRole('COOK')">
                <a class="dropdown-item" th:href="@{/cook}">
                  <i class="bi bi-fire me-2"></i>Kuchyňa
                </a>
              </li>
              <li sec:authorize="hasRole('COURIER')">
                <a class="dropdown-item" th:href="@{/courier}">
                  <i class="bi bi-truck me-2"></i>Doručovanie
                </a>
              </li>
              <li sec:authorize="hasRole('ADMIN')">
                <a class="dropdown-item" th:href="@{/admin}">
                  <i class="bi bi-gear me-2"></i>Administrácia
                </a>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <form th:action="@{/auth/logout}" method="post">
                  <button type="submit" class="dropdown-item">
                    <i class="bi bi-box-arrow-right me-2"></i>Odhlásiť
                  </button>
                </form>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Footer Fragment -->
  <footer th:fragment="footer" class="footer">
    <div class="container text-center">
      <p class="mb-2" style="font-family: 'Fredoka One', cursive; color: var(--primary-yellow)">
        <i class="bi bi-emoji-laughing me-2"></i>Clown Pizzeria
      </p>
      <p class="text-muted small mb-0">&copy; 2026 Clown Pizzeria. Všetky práva vyhradené.</p>
    </div>
  </footer>

  <!-- Scripts Fragment -->
  <div th:fragment="scripts">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script th:inline="javascript">
      function updateCartBadge() {
        fetch('/cart/count')
          .then((response) => response.json())
          .then((data) => {
            const badge = document.getElementById('cartBadge');
            if (badge) {
              badge.textContent = data.cartCount;
              badge.style.display = data.cartCount > 0 ? 'inline' : 'none';
            }
          });
      }
    </script>
  </div>
</html>
